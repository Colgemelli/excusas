<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Excusas y Permisos - Colegio</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Cargando...</p>
        <button id="reloadBtn" onclick="window.location.reload()" style="
            margin-top: 20px; padding: 10px 20px; background: #007bff; 
            color: white; border: none; border-radius: 5px; cursor: pointer;
            display: none;
        ">üîÑ Recargar P√°gina</button>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1>üè´ Sistema de Excusas y Permisos</h1>
            <nav>
                <button id="homeBtn" class="nav-btn active">Inicio</button>
                <button id="consultBtn" class="nav-btn">Consultar Radicado</button>
                <button id="loginBtn" class="nav-btn">Acceso Docentes</button>
                <div id="userInfo" class="user-info" style="display: none;">
                    <span id="userName"></span>
                    <button id="logoutBtn" class="logout-btn">Cerrar Sesi√≥n</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Home View -->
        <section id="homeView" class="view active">
            <div class="container">
                <div class="welcome-section">
                    <h2>Bienvenido al Sistema de Gesti√≥n</h2>
                    <p>Selecciona el tipo de solicitud que deseas realizar:</p>
                </div>
                
                <div class="options-grid">
                    <div class="option-card" data-type="excusa">
                        <div class="option-icon">üìã</div>
                        <h3>Excusa</h3>
                        <p>Para justificar ausencias por motivos de salud, citas m√©dicas o situaciones familiares</p>
                        <button class="option-btn">Solicitar Excusa</button>
                    </div>
                    
                    <div class="option-card" data-type="permiso">
                        <div class="option-icon">üé´</div>
                        <h3>Permiso</h3>
                        <p>Para solicitar autorizaci√≥n de salida anticipada o ausencia programada</p>
                        <button class="option-btn">Solicitar Permiso</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form View -->
        <section id="formView" class="view">
            <div class="container">
                <div class="form-header">
                    <button id="backToHome" class="back-btn">‚Üê Volver al inicio</button>
                    <h2 id="formTitle">Solicitud de Excusa</h2>
                </div>

                <div class="stepper">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <span>Protecci√≥n de Datos</span>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <span>Datos del Solicitante</span>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <span>Datos del Estudiante</span>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <span>Detalles de la Solicitud</span>
                    </div>
                    <div class="step" data-step="5">
                        <div class="step-number">5</div>
                        <span>Confirmaci√≥n</span>
                    </div>
                </div>

                <form id="requestForm" class="request-form">
                    <!-- Step 1: Data Protection -->
                    <div class="form-step active" data-step="1">
                        <h3>Autorizaci√≥n para el Tratamiento de Datos Personales</h3>
                        <div class="institution-header">
                            <h4>üè´ COLEGIO GEMELLI FRANCISCANOS</h4>
                            <p><strong>Formando Hombres y Mujeres de Paz y Bien</strong></p>
                            <p>Manizales, Caldas - Colombia</p>
                        </div>
                        
                        <div class="data-protection">
                            <div class="legal-framework">
                                <h5>üìã Marco Legal</h5>
                                <p>En cumplimiento de la <strong>Ley 1581 de 2012</strong> y el <strong>Decreto 1377 de 2013</strong> sobre protecci√≥n de datos personales, el Colegio Gemelli Franciscanos informa:</p>
                            </div>
                            
                            <div class="treatment-purposes">
                                <h5>üéØ Prop√≥sitos del Tratamiento</h5>
                                <ul>
                                    <li>Gesti√≥n acad√©mica y administrativa</li>
                                    <li>Comunicaci√≥n institucional con padres de familia</li>
                                    <li>Seguimiento y control de excusas y permisos estudiantiles</li>
                                    <li>Archivo y consulta de registros acad√©micos</li>
                                    <li>Cumplimiento de obligaciones legales educativas</li>
                                </ul>
                            </div>
                            
                            <div class="rights-section">
                                <h5>‚öñÔ∏è Sus Derechos como Titular</h5>
                                <ul>
                                    <li><strong>Conocer:</strong> Informaci√≥n sobre el uso de sus datos</li>
                                    <li><strong>Actualizar:</strong> Modificar datos inexactos o incompletos</li>
                                    <li><strong>Rectificar:</strong> Corregir informaci√≥n err√≥nea</li>
                                    <li><strong>Suprimir:</strong> Solicitar eliminaci√≥n cuando sea procedente</li>
                                    <li><strong>Revocar:</strong> Retirar autorizaci√≥n en casos permitidos por ley</li>
                                </ul>
                            </div>
                            
                            <div class="security-measures">
                                <h5>üîí Medidas de Seguridad</h5>
                                <p>El colegio implementa medidas t√©cnicas, humanas y administrativas para proteger la informaci√≥n personal contra p√©rdida, alteraci√≥n, tratamiento o acceso no autorizado.</p>
                            </div>
                            
                            <div class="validity-section">
                                <h5>üìÖ Vigencia de la Autorizaci√≥n</h5>
                                <p>Esta autorizaci√≥n permanecer√° vigente hasta que el titular solicite su revocaci√≥n o finalice la relaci√≥n con la instituci√≥n educativa.</p>
                            </div>
                            
                            <div class="contact-info">
                                <h5>üìû Contacto para Ejercer Derechos</h5>
                                <p>Para ejercer sus derechos, contacte al colegio a trav√©s de los canales oficiales de comunicaci√≥n institucional.</p>
                            </div>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="dataProtection" required>
                                <span class="checkmark"></span>
                                <strong>Autorizo de manera libre, previa, expresa e informada al Colegio Gemelli Franciscanos para el tratamiento de mis datos personales conforme a la pol√≠tica institucional</strong>
                            </label>
                        </div>
                    </div>

                    <!-- Step 2: Registrant Data -->
                    <div class="form-step" data-step="2">
                        <h3>Datos del Solicitante</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="registrantName">Nombre completo *</label>
                                <input type="text" id="registrantName" required>
                            </div>
                            <div class="form-group">
                                <label for="registrantEmail">Correo electr√≥nico *</label>
                                <input type="email" id="registrantEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="registrantPhone">Tel√©fono *</label>
                                <input type="tel" id="registrantPhone" required minlength="10" pattern="[0-9]{10,}">
                                <small>M√≠nimo 10 d√≠gitos</small>
                            </div>
                            <div class="form-group">
                                <label for="relationship">Relaci√≥n con el estudiante *</label>
                                <select id="relationship" required>
                                    <option value="">Seleccione...</option>
                                    <option value="madre">Madre</option>
                                    <option value="padre">Padre</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                            <div class="form-group" id="otherRelationshipGroup" style="display: none;">
                                <label for="otherRelationship">Especifique la relaci√≥n *</label>
                                <input type="text" id="otherRelationship">
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Student Data -->
                    <div class="form-step" data-step="3">
                        <h3>Datos del Estudiante</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="studentGrade">Grado *</label>
                                <select id="studentGrade" required>
                                    <option value="">Seleccione el grado...</option>
                                    <option value="pre-jard√≠n">Pre-jard√≠n</option>
                                    <option value="jard√≠n">Jard√≠n</option>
                                    <option value="transici√≥n">Transici√≥n</option>
                                    <option value="primero">Primero</option>
                                    <option value="segundo">Segundo</option>
                                    <option value="tercero">Tercero</option>
                                    <option value="cuarto">Cuarto</option>
                                    <option value="quinto">Quinto</option>
                                    <option value="sexto">Sexto</option>
                                    <option value="s√©ptimo">S√©ptimo</option>
                                    <option value="octavo">Octavo</option>
                                    <option value="noveno">Noveno</option>
                                    <option value="d√©cimo">D√©cimo</option>
                                    <option value="und√©cimo">Und√©cimo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="studentSelect">Estudiante *</label>
                                <select id="studentSelect" required disabled>
                                    <option value="">Primero seleccione el grado</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="studentCode">C√≥digo del estudiante</label>
                                <input type="text" id="studentCode" readonly>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Request Details -->
                    <div class="form-step" data-step="4">
                        <h3>Detalles de la Solicitud</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="startDate">Fecha de inicio *</label>
                                <input type="date" id="startDate" required>
                            </div>
                            <div class="form-group" id="endDateGroup">
                                <label for="endDate">Fecha de fin</label>
                                <input type="date" id="endDate">
                                <small>Para permisos de varios d√≠as</small>
                            </div>
                            
                            <!-- Campos espec√≠ficos para PERMISOS -->
                            <div class="permission-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="startTime">Hora de salida *</label>
                                    <input type="time" id="startTime">
                                </div>
                                <div class="form-group">
                                    <label for="endTime">Hora de regreso</label>
                                    <input type="time" id="endTime">
                                    <small>Si aplica</small>
                                </div>
                            </div>
                            
                            <!-- Campos espec√≠ficos para EXCUSAS -->
                            <div class="excuse-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="absenceDays">D√≠a(s) de inasistencia *</label>
                                    <input type="text" id="absenceDays" placeholder="Ej: 15, 16 y 17">
                                    <small>Especifique los d√≠as exactos</small>
                                </div>
                                <div class="form-group">
                                    <label for="absenceMonth">Mes de inasistencia *</label>
                                    <select id="absenceMonth">
                                        <option value="">Seleccione el mes...</option>
                                        <option value="enero">Enero</option>
                                        <option value="febrero">Febrero</option>
                                        <option value="marzo">Marzo</option>
                                        <option value="abril">Abril</option>
                                        <option value="mayo">Mayo</option>
                                        <option value="junio">Junio</option>
                                        <option value="julio">Julio</option>
                                        <option value="agosto">Agosto</option>
                                        <option value="septiembre">Septiembre</option>
                                        <option value="octubre">Octubre</option>
                                        <option value="noviembre">Noviembre</option>
                                        <option value="diciembre">Diciembre</option>
                                    </select>
                                    <small>Se mostrar√°n solo los meses v√°lidos seg√∫n la fecha seleccionada</small>
                                </div>
                                <div class="form-group full-width">
                                    <label>Documentos de soporte</label>
                                    <div class="checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="medicalCertificate">
                                            <span class="checkmark"></span>
                                            Certificado m√©dico
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="incapacityCertificate">
                                            <span class="checkmark"></span>
                                            Incapacidad
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="reason">Motivo *</label>
                                <select id="reason" required>
                                    <option value="">Seleccione el motivo...</option>
                                    <option value="cita_medica">Cita m√©dica</option>
                                    <option value="enfermedad">Enfermedad</option>
                                    <option value="calamidad_domestica">Calamidad dom√©stica</option>
                                    <option value="viaje_familiar">Viaje familiar</option>
                                    <option value="tramites_personales">Tr√°mites personales</option>
                                    <option value="actividad_familiar">Actividad familiar</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label for="description">Descripci√≥n detallada del motivo *</label>
                                <textarea id="description" rows="4" required placeholder="Proporcione detalles espec√≠ficos sobre el motivo de la solicitud..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Confirmation -->
                    <div class="form-step" data-step="5">
                        <h3>Confirmaci√≥n de Solicitud</h3>
                        <div class="confirmation-summary">
                            <h4>Resumen de la solicitud:</h4>
                            <div id="summaryContent"></div>
                            <p class="important-note">
                                <strong>Importante:</strong> Una vez enviada la solicitud, recibir√° un n√∫mero de radicado para hacer seguimiento del estado de su petici√≥n.
                            </p>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="prevBtn" class="btn-secondary" style="display: none;">Anterior</button>
                        <button type="button" id="nextBtn" class="btn-primary">Siguiente</button>
                        <button type="submit" id="submitBtn" class="btn-success" style="display: none;">Enviar Solicitud</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Consult View -->
        <section id="consultView" class="view">
            <div class="container">
                <h2>Consultar Estado de Radicado</h2>
                <div class="consult-form">
                    <div class="form-group">
                        <label for="filingNumber">N√∫mero de radicado</label>
                        <input type="text" id="filingNumber" placeholder="Ej: RAD202406280001">
                    </div>
                    <button id="consultBtn" class="btn-primary">Consultar</button>
                </div>
                <div id="consultResult" class="consult-result"></div>
            </div>
        </section>

        <!-- Login View -->
        <section id="loginView" class="view">
            <div class="container">
                <div class="login-container">
                    <h2>Acceso al Sistema</h2>
                    <div class="login-tabs">
                        <button class="tab-btn active" data-role="coordinator">Coordinador</button>
                        <button class="tab-btn" data-role="teacher">Docente</button>
                        <button class="tab-btn" data-role="admin">Administrador</button>
                    </div>
                    <form id="loginForm" class="login-form">
                        <div class="form-group">
                            <label for="username">Usuario</label>
                            <input type="text" id="username" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Contrase√±a</label>
                            <input type="password" id="password" required>
                        </div>
                        <button type="submit" class="btn-primary">Iniciar Sesi√≥n</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Dashboard View -->
        <section id="dashboardView" class="view">
            <div class="container">
                <div class="dashboard-header">
                    <h2>Panel de Control</h2>
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <h3 id="todayRequests">0</h3>
                            <p>Solicitudes Hoy</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="pendingRequests">0</h3>
                            <p>Pendientes</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="approvedRequests">0</h3>
                            <p>Aprobadas</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="requests-table">
                        <h3>Solicitudes Pendientes</h3>
                        <div id="requestsList" class="table-container"></div>
                    </div>

                    <div class="charts-section">
                        <div class="chart-container">
                            <h3>Solicitudes por Grado</h3>
                            <canvas id="gradeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Success Modal -->
        <div id="successModal" class="modal">
            <div class="modal-content">
                <h3>‚úÖ Solicitud Enviada Exitosamente</h3>
                <p>Su radicado es: <strong id="generatedFiling"></strong></p>
                <p>Puede consultar el estado de su solicitud usando este n√∫mero.</p>
                <button id="closeModal" class="btn-primary">Cerrar</button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Sistema de Excusas y Permisos - Colegio</p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>
