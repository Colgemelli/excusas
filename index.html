<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Excusas y Permisos - Colegio Gemelli Franciscanos</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Supabase -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/supabase-js/2.38.0/supabase.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <i class="fas fa-graduation-cap"></i>
                <h1>Sistema de Excusas y Permisos</h1>
            </div>
            <nav class="nav-buttons">
                <button id="inicioBtn" class="nav-btn active">Inicio</button>
                <button id="consultarBtn" class="nav-btn">Consultar Radicado</button>
                <button id="docentesBtn" class="nav-btn">Acceso Docentes</button>
                <button id="loginBtn" class="nav-btn">Login</button>
            </nav>
            <div class="status-indicator">
                <span id="statusText">🟡 Inicializando...</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Vista Principal (Padres de Familia) -->
        <section id="homeView" class="view active">
            <div class="container">
                <div class="welcome-section">
                    <h2>Bienvenido al Sistema de Gestión</h2>
                    <p>Selecciona el tipo de solicitud que deseas realizar:</p>
                </div>
                
                <div class="request-options">
                    <div class="option-card" id="excusaCard">
                        <div class="option-icon">
                            <i class="fas fa-file-medical"></i>
                        </div>
                        <h3>Excusa</h3>
                        <p>Para justificar ausencias por motivos de salud, citas médicas o situaciones familiares</p>
                        <button class="btn-primary">Solicitar Excusa</button>
                    </div>
                    
                    <div class="option-card" id="permisoCard">
                        <div class="option-icon">
                            <i class="fas fa-file-signature"></i>
                        </div>
                        <h3>Permiso</h3>
                        <p>Para solicitar autorización de salida anticipada o ausencia programada</p>
                        <button class="btn-primary">Solicitar Permiso</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vista Formulario Excusa -->
        <section id="excusaView" class="view">
            <div class="container">
                <div class="form-header">
                    <button id="backToHome" class="btn-secondary">
                        <i class="fas fa-arrow-left"></i> Volver
                    </button>
                    <h2>Formato Único de Excusa</h2>
                </div>
                
                <form id="excusaForm" class="form-container">
                    <div class="form-group">
                        <label for="fechaExcusa">Fecha:</label>
                        <input type="date" id="fechaExcusa" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nombreEstudianteExcusa">Nombre del Estudiante:</label>
                            <input type="text" id="nombreEstudianteExcusa" required>
                        </div>
                        <div class="form-group">
                            <label for="gradoExcusa">Grado:</label>
                            <select id="gradoExcusa" required>
                                <option value="">Seleccionar...</option>
                                <option value="Preescolar">Preescolar</option>
                                <option value="1°">1°</option>
                                <option value="2°">2°</option>
                                <option value="3°">3°</option>
                                <option value="4°">4°</option>
                                <option value="5°">5°</option>
                                <option value="6°">6°</option>
                                <option value="7°">7°</option>
                                <option value="8°">8°</option>
                                <option value="9°">9°</option>
                                <option value="10°">10°</option>
                                <option value="11°">11°</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="diasInasistencia">Día(s) de inasistencia:</label>
                            <input type="text" id="diasInasistencia" placeholder="Ej: 15, 16" required>
                        </div>
                        <div class="form-group">
                            <label for="mesInasistencia">Mes:</label>
                            <select id="mesInasistencia" required>
                                <option value="">Seleccionar...</option>
                                <option value="Enero">Enero</option>
                                <option value="Febrero">Febrero</option>
                                <option value="Marzo">Marzo</option>
                                <option value="Abril">Abril</option>
                                <option value="Mayo">Mayo</option>
                                <option value="Junio">Junio</option>
                                <option value="Julio">Julio</option>
                                <option value="Agosto">Agosto</option>
                                <option value="Septiembre">Septiembre</option>
                                <option value="Octubre">Octubre</option>
                                <option value="Noviembre">Noviembre</option>
                                <option value="Diciembre">Diciembre</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivoInasistencia">Motivo de la inasistencia:</label>
                        <textarea id="motivoInasistencia" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-row checkbox-row">
                        <div class="checkbox-group">
                            <input type="checkbox" id="certificadoMedico">
                            <label for="certificadoMedico">Certificado Médico</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="incapacidad">
                            <label for="incapacidad">Incapacidad</label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="archivoGroup" style="display: none;">
                        <label for="archivoAdjunto">Adjuntar documento:</label>
                        <input type="file" id="archivoAdjunto" accept=".pdf,.jpg,.jpeg,.png">
                    </div>
                    
                    <div class="form-group">
                        <label for="firmaPadreExcusa">Nombre y firma del padre de familia y/o acudiente:</label>
                        <input type="text" id="firmaPadreExcusa" required>
                    </div>
                    
                    <button type="submit" class="btn-primary">Generar Excusa</button>
                </form>
            </div>
        </section>

        <!-- Vista Formulario Permiso -->
        <section id="permisoView" class="view">
            <div class="container">
                <div class="form-header">
                    <button id="backToHomePermiso" class="btn-secondary">
                        <i class="fas fa-arrow-left"></i> Volver
                    </button>
                    <h2>Formato de Permisos y Autorizaciones</h2>
                </div>
                
                <form id="permisoForm" class="form-container">
                    <div class="form-group">
                        <label for="fechaPermiso">Fecha:</label>
                        <input type="date" id="fechaPermiso" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nombreEstudiantePermiso">Nombre del Estudiante:</label>
                            <input type="text" id="nombreEstudiantePermiso" required>
                        </div>
                        <div class="form-group">
                            <label for="gradoPermiso">Grado:</label>
                            <select id="gradoPermiso" required>
                                <option value="">Seleccionar...</option>
                                <option value="Preescolar">Preescolar</option>
                                <option value="1°">1°</option>
                                <option value="2°">2°</option>
                                <option value="3°">3°</option>
                                <option value="4°">4°</option>
                                <option value="5°">5°</option>
                                <option value="6°">6°</option>
                                <option value="7°">7°</option>
                                <option value="8°">8°</option>
                                <option value="9°">9°</option>
                                <option value="10°">10°</option>
                                <option value="11°">11°</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivoPermiso">Motivo del permiso o autorización:</label>
                        <textarea id="motivoPermiso" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="horaSalida">Hora de salida:</label>
                            <input type="time" id="horaSalida" required>
                        </div>
                        <div class="form-group">
                            <label for="horaRegreso">Hora de regreso (si aplica):</label>
                            <input type="time" id="horaRegreso">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="firmaPadrePermiso">Nombre y firma del padre de familia y/o acudiente:</label>
                        <input type="text" id="firmaPadrePermiso" required>
                    </div>
                    
                    <button type="submit" class="btn-primary">Generar Permiso</button>
                </form>
            </div>
        </section>

        <!-- Vista Consultar Radicado -->
        <section id="consultarView" class="view">
            <div class="container">
                <div class="form-header">
                    <h2>Consultar por Número de Radicado</h2>
                </div>
                
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="numeroRadicado" placeholder="Ingrese el número de radicado">
                        <button id="buscarBtn" class="btn-primary">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                    </div>
                </div>
                
                <div id="resultadoConsulta" class="resultado-container" style="display: none;">
                    <!-- Aquí se mostrará el resultado de la consulta -->
                </div>
            </div>
        </section>

        <!-- Vista Login -->
        <section id="loginView" class="view">
            <div class="container">
                <div class="login-container">
                    <h2>Acceso al Sistema</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="usuario">Usuario:</label>
                            <input type="text" id="usuario" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Contraseña:</label>
                            <input type="password" id="password" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tipoUsuario">Tipo de Usuario:</label>
                            <select id="tipoUsuario" required>
                                <option value="">Seleccionar...</option>
                                <option value="coordinador">Coordinador/Directora Académica</option>
                                <option value="docente">Docente</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn-primary">Iniciar Sesión</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Vista Dashboard Coordinador -->
        <section id="coordinadorView" class="view">
            <div class="container">
                <div class="dashboard-header">
                    <h2>Panel de Coordinación</h2>
                    <button id="logoutBtn" class="btn-secondary">Cerrar Sesión</button>
                </div>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <h3>Solicitudes Pendientes</h3>
                        <span class="stat-number" id="pendientesCount">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Aprobadas Hoy</h3>
                        <span class="stat-number" id="aprobadasHoy">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Total del Mes</h3>
                        <span class="stat-number" id="totalMes">0</span>
                    </div>
                </div>
                
                <div class="solicitudes-list">
                    <h3>Solicitudes Pendientes de Revisión</h3>
                    <div id="listaSolicitudes">
                        <!-- Aquí se cargarán las solicitudes -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Vista Dashboard Docente -->
        <section id="docenteView" class="view">
            <div class="container">
                <div class="dashboard-header">
                    <h2>Panel de Validación Docente</h2>
                    <button id="logoutDocenteBtn" class="btn-secondary">Cerrar Sesión</button>
                </div>
                
                <div class="docente-filters">
                    <select id="filtroGrado">
                        <option value="">Todos los grados</option>
                        <option value="Preescolar">Preescolar</option>
                        <option value="1°">1°</option>
                        <option value="2°">2°</option>
                        <option value="3°">3°</option>
                        <option value="4°">4°</option>
                        <option value="5°">5°</option>
                        <option value="6°">6°</option>
                        <option value="7°">7°</option>
                        <option value="8°">8°</option>
                        <option value="9°">9°</option>
                        <option value="10°">10°</option>
                        <option value="11°">11°</option>
                    </select>
                </div>
                
                <div class="solicitudes-docente" id="solicitudesDocente">
                    <!-- Aquí se cargarán las solicitudes aprobadas para validación -->
                </div>
            </div>
        </section>

        <!-- Vista Dashboard Admin -->
        <section id="adminView" class="view">
            <div class="container">
                <div class="dashboard-header">
                    <h2>Panel de Administración</h2>
                    <button id="logoutAdminBtn" class="btn-secondary">Cerrar Sesión</button>
                </div>
                
                <div class="admin-stats">
                    <div class="stat-card">
                        <h3>Total Solicitudes</h3>
                        <span class="stat-number" id="totalSolicitudes">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Tasa de Aprobación</h3>
                        <span class="stat-number" id="tasaAprobacion">0%</span>
                    </div>
                    <div class="stat-card">
                        <h3>Promedio Diario</h3>
                        <span class="stat-number" id="promedioDiario">0</span>
                    </div>
                </div>
                
                <div class="admin-charts">
                    <div class="chart-container">
                        <h3>Grados con más solicitudes</h3>
                        <div id="gradosChart"></div>
                    </div>
                    <div class="chart-container">
                        <h3>Histórico mensual</h3>
                        <div id="historicoChart"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modales -->
    <!-- Modal Protección de Datos -->
    <div id="modalProteccionDatos" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🔐 Protección de Datos Personales</h3>
            </div>
            <div class="modal-body">
                <p>En cumplimiento de la Ley 1581 de 2012 y el Decreto 1377 de 2013, autorizo al <strong>Colegio Gemelli Franciscanos</strong> para el tratamiento de mis datos personales con fines académicos y administrativos.</p>
                
                <p>Se garantizan medidas de seguridad adecuadas y se reconocen mis derechos como titular de la información. Esta autorización tendrá vigencia mientras se mantenga la relación con la institución.</p>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="aceptoProteccion">
                    <label for="aceptoProteccion">Acepto el tratamiento de mis datos personales</label>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelarProteccion" class="btn-secondary">Cancelar</button>
                <button id="aceptarProteccion" class="btn-primary" disabled>Continuar</button>
            </div>
        </div>
    </div>

    <!-- Modal Radicado Generado -->
    <div id="modalRadicado" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>✅ Solicitud Enviada Exitosamente</h3>
            </div>
            <div class="modal-body">
                <div class="radicado-info">
                    <p>Su solicitud ha sido registrada con el siguiente número de radicado:</p>
                    <div class="radicado-number" id="numeroRadicadoGenerado"></div>
                    <p>Guarde este número para consultar el estado de su solicitud.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cerrarModalRadicado" class="btn-primary">Entendido</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmación Coordinador -->
    <div id="modalConfirmacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="tituloConfirmacion">Confirmar Acción</h3>
            </div>
            <div class="modal-body">
                <p id="mensajeConfirmacion"></p>
                <div class="form-group" id="observacionesGroup" style="display: none;">
                    <label for="observaciones">Observaciones:</label>
                    <textarea id="observaciones" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelarAccion" class="btn-secondary">Cancelar</button>
                <button id="confirmarAccion" class="btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>© 2025 Sistema de Excusas y Permisos - Colegio Gemelli Franciscanos</p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>
